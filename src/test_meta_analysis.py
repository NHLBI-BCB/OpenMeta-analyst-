####################################
#                                  #
# unit tests for meta_py_r module  #
#                                  #
# Author: George Dietz             #
#         CEBM@Brown               #
#                                  #
####################################

''' Desired tests:
Regular meta-analysis:
[X] binary data * analysis methods
[X] continuous data * analysis methods
[X] diagnostic data * sens/spec * method (4)
                    * dor/lor   * method (3)

Cumulative meta-analysis:
[X] binary data * analysis methods
[X] continuous data * analysis methods
[X] diagnostic data * analysis methods

Subgroup meta-analysis: (factor covariate)
[ ] binary data * analysis method (4)
[ ] continuous data * analysis method (2)
[ ] diagnostic data * sens * method
                      spec * method
                      dor  * method
                      lor  * method


leave-one-out meta-analysis:
[X] binary data * analysis methods
[X] continuous data * analysis methods
[X] diagnostic data * sens/spec * method (4)
                    * dor/lor   * method (3)

meta-regression:
[ ] binary data
    [ ] continuous covariate
    [ ] factor covariate
[ ] continuous data
    [ ] continuous covariate
    [ ] factor covariate
[ ] diagnostic data
    [ ] continuous covariate
    [ ] factor covariate
'''

import nose
from nose import with_setup, tools
import os, sys

from PyQt4 import QtCore, QtGui, Qt
from PyQt4.Qt import *


#import meta_py_r # this needs to come first or else weird stuff happens w/ nose
#import meta_globals

print("Importing meta_globals")
#import meta_globals
print("Importing meta_form")
import meta_form
print("Importing meta_py_r")
import meta_py_r


from types import (NoneType, BooleanType, IntType, LongType, FloatType,
                   StringType, UnicodeType, ListType, DictType, TupleType)

simple_types = [NoneType, BooleanType, IntType, LongType, FloatType,
                StringType, UnicodeType]

def _compare_dicts(dA, dB):
    '''dA and dB are two dictionaries who have some elements which are dictionaries, etc. Otherwise the elements are just non-iterable types'''
    
    if set(dA.keys()) != set(dB.keys()):
        return False

    # keys are verified the same at this point
    for k,val_A in dA.items():
        val_B = dB[k]
        
        # must be the same type
        if type(val_A) != type(val_B):
            return False
        data_type = type(val_A)
        
        if data_type == DictType:
            equal_vals = _compare_dicts(val_A, val_B)
        else:
            equal_vals = _compare_values(val_A, val_B)
            
        if not equal_vals:
            return False
    
    return True # if we managed to get here despite all the checks we are golden
        
def _compare_values(valA, valB):
    ''' Returns true if the values of valA and valB are equal. Deals with
    lists, tuples, dictionaries as well as the normal basic types  '''
    
    if type(valA) != type(valB):
        return False
    
    data_type = type(valA)
    
    if data_type in [ListType, TupleType]:
        if len(valA) != len(valB):
            return False
        for x,y in zip(valA, valB):
            return _compare_values(x,y)
    elif data_type == DictType:
        return _compare_dicts(valA, valB)
    elif data_type in simple_types:
        return valA == valB
    else:
        print("Type %s not recognized, cannot compare" % data_type)
        raise TypeError("Type %s not recognized, cannot compare" % data_type)


app,meta = None, None

def setup_module(module): # runs before any method in the class
    print("")
    print("ENTERING SETUP MODULE ------------------------------------------------")
    
    # load R libraries
    rloader = meta_py_r.RlibLoader()
    rloader.load_all()
    
    global app, meta
    app = QtGui.QApplication(sys.argv)
    meta = meta_form.MetaForm()
    #meta.tableView.setSelectionMode(QTableView.ContiguousSelection)
    meta.show()
    app.processEvents()
    
    
def teardown_module(module):
    QApplication.quit()

################### BINARY META ANALYSIS TESTS ################################

#def test_dummy():
#    print("Running test dummy")
#    assert True
        
def test_binary_meta_analysis():
    
    fullpath = os.path.join(os.getcwd(),"../sample_data", "amino.oma")

    meta.open(fullpath)
    app.processEvents() #show the data
    
    meta_py_r.ma_dataset_to_simple_binary_robj(meta.model)
    
    method_and_params = []
    method_and_params.append({'method':"binary.random",
                              'parameters':{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results':{'images': {'Forest Plot': './r_tmp/forest.png'}, 'texts': {'Weights': 'studies             weights\nGonzalez       1993  7.3%\nPrins          1993  6.2%\nGiamarellou    1991  2.1%\nMaller         1993 10.7%\nSturm          1989  2.0%\nMarik          1991 12.2%\nMuijsken       1988  7.5%\nVigano         1992  1.8%\nHansen         1988  5.3%\nDe Vries       1990  6.1%\nMauracher      1989  2.2%\nNordstrom      1990  5.3%\nRozdzinski     1993 10.3%\nTer Braak      1990  8.7%\nTulkens        1988  1.2%\nVan der Auwera 1991  2.0%\nKlastersky     1977  6.0%\nVanhaeverbeek  1993  1.2%\nHollender      1989  1.8%\n', 'Summary': 'Binary Random-Effects Model\n\nMetric: Odds Ratio\n\n Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.770        0.485         1.222       0.267   \n\n\n Heterogeneity\n\n tau^2  Q(df=18)   Het. p-Value   I^2  \n\n 0.378   33.360        0.015      46%  \n\n\n Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.262      -0.724         0.200         0.236    \n\n\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371560122.39001'}, 'image_order': None},
                              })
    method_and_params.append({'method':"binary.fixed.peto",
                              'parameters':{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results':{'images': {'Forest Plot': './r_tmp/forest.png'}, 'texts': {'References': '[1] "Yusuf, S., Peto, R., Lewis, J., Collins, R., & Sleight, P. (1985). Beta blockade during and after myocardial infarction: An overview of the randomized trials. Progress in Cardiovascular Disease, 27, 335-371."\n', 'Weights': 'studies             weights\nGonzalez       1993  5.1%\nPrins          1993  4.3%\nGiamarellou    1991  2.5%\nMaller         1993 13.3%\nSturm          1989  1.3%\nMarik          1991 26.0%\nMuijsken       1988  5.2%\nVigano         1992  0.9%\nHansen         1988  4.7%\nDe Vries       1990  3.9%\nMauracher      1989  3.1%\nNordstrom      1990  2.9%\nRozdzinski     1993 11.5%\nTer Braak      1990  7.3%\nTulkens        1988  0.5%\nVan der Auwera 1991  1.3%\nKlastersky     1977  4.7%\nVanhaeverbeek  1993  0.5%\nHollender      1989  0.9%\n', 'Summary': 'Binary Fixed-Effect Model - Peto\n\nMetric: Odds Ratio\n\n Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.718        0.550         0.937       0.015   \n\n\n Heterogeneity\n\n Q(df=18)  Het. p-Value   I^2  \n\n 37.229        0.005      52%  \n\n\n Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.331      -0.597        -0.065         0.136    \n\n\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371560197.03328'}, 'image_order': None},
                              })
    method_and_params.append({'method':"binary.fixed.mh",
                              'parameters':{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results':{'images': {'Forest Plot': './r_tmp/forest.png'}, 'texts': {'References': '[1] "Mantel, N., & Haenszel, W. (1959) Statistical aspects of the analysis of data from retrospective studies of disease. Journal of the National Cancer Institute, 22, 719-748."\n', 'Weights': 'studies             weights\nGonzalez       1993  5.6%\nPrins          1993  5.1%\nGiamarellou    1991  4.0%\nMaller         1993  9.6%\nSturm          1989  1.6%\nMarik          1991 33.8%\nMuijsken       1988  3.4%\nVigano         1992  0.0%\nHansen         1988  7.8%\nDe Vries       1990  2.3%\nMauracher      1989  4.8%\nNordstrom      1990  3.0%\nRozdzinski     1993  9.9%\nTer Braak      1990  5.4%\nTulkens        1988  0.0%\nVan der Auwera 1991  1.6%\nKlastersky     1977  1.3%\nVanhaeverbeek  1993  0.0%\nHollender      1989  0.8%\n', 'Summary': 'Binary Fixed-Effect Model - Mantel Haenszel\n\nMetric: Odds Ratio\n\n Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.712        0.543         0.934       0.014   \n\n\n Heterogeneity\n\n Q(df=18)  Het. p-Value   I^2  \n\n 33.557        0.014      46%  \n\n\n Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.340      -0.611        -0.069         0.138    \n\n\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371560599.03599'}, 'image_order': None},
                              })
    method_and_params.append({'method':"binary.fixed.inv.var",
                              'parameters':{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results':{'images': {'Forest Plot': './r_tmp/forest.png'}, 'texts': {'Weights': 'studies             weights\nGonzalez       1993  5.6%\nPrins          1993  4.2%\nGiamarellou    1991  0.9%\nMaller         1993 14.8%\nSturm          1989  0.9%\nMarik          1991 27.6%\nMuijsken       1988  5.8%\nVigano         1992  0.8%\nHansen         1988  3.1%\nDe Vries       1990  4.0%\nMauracher      1989  1.0%\nNordstrom      1990  3.2%\nRozdzinski     1993 13.2%\nTer Braak      1990  8.3%\nTulkens        1988  0.5%\nVan der Auwera 1991  0.9%\nKlastersky     1977  3.9%\nVanhaeverbeek  1993  0.5%\nHollender      1989  0.8%\n', 'Summary': 'Binary Fixed-Effect Model - Inverse Variance\n\nMetric: Odds Ratio\n\n Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.760        0.571         1.011       0.059   \n\n\n Heterogeneity\n\n Q(df=18)  Het. p-Value   I^2  \n\n 33.360        0.015      46%  \n\n\n Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.275      -0.561         0.011         0.146    \n\n\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371560784.58866'}, 'image_order': None},
                              })
    
    # for now just check that images and texts match
    for t in method_and_params:
        check_binary_meta_analysis.description = "Testing Binary Meta Analysis %s" % t['method']
        yield check_binary_meta_analysis, t
        
def test_binary_meta_analysis_meta_methods():
    fullpath = os.path.join(os.getcwd(),"../sample_data", "amino.oma")

    meta.open(fullpath)
    app.processEvents() #show the data
    meta_py_r.ma_dataset_to_simple_binary_robj(meta.model)
    
    method_and_params = []
    #### CUMULATIVE MA BINARY #####
    method_and_params.append({'meta_f_str': "cum.ma.binary",
                              'method'    : "binary.random",
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Cumulative Forest Plot': './r_tmp/forest.png'}, 'texts': {'Cumulative Summary': 'Binary Random-Effects Model\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error   p-Val  \n\n Gonzalez            0.571       0.170         1.916         0.617       NA   \n\n + Prins             0.509       0.204         1.273         0.467     0.149  \n\n + Giamarellou       0.430       0.180         1.032         0.446     0.059  \n\n + Maller            0.657       0.268         1.609         0.457     0.358  \n\n + Sturm             0.614       0.265         1.422         0.428     0.255  \n\n + Marik             0.540       0.275         1.060         0.344     0.073  \n\n + Muijsken          0.634       0.334         1.205         0.328     0.164  \n\n + Vigano            0.668       0.358         1.246         0.318     0.205  \n\n + Hansen            0.572       0.305         1.073         0.321     0.082  \n\n + De Vries          0.646       0.352         1.188         0.310     0.160  \n\n + Mauracher         0.594       0.323         1.095         0.312     0.095  \n\n + Nordstrom         0.606       0.345         1.062         0.287     0.080  \n\n + Rozdzinski        0.655       0.398         1.078         0.255     0.096  \n\n + Ter Braak         0.706       0.442         1.127         0.239     0.145  \n\n + Tulkens           0.712       0.453         1.121         0.231     0.143  \n\n + Van der Auwera    0.696       0.446         1.086         0.227     0.110  \n\n + Klastersky        0.775       0.477         1.258         0.247     0.302  \n\n + Vanhaeverbeek     0.780       0.486         1.253         0.241     0.304  \n\n + Hollender         0.770       0.485         1.222         0.236     0.267  \n\n\n'}, 'image_var_names': {'cumulative forest plot': 'cumulative_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371575868.36483'}, 'image_order': None},
                              })
    method_and_params.append({'meta_f_str': "cum.ma.binary",
                              'method'    : "binary.fixed.peto",
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Cumulative Forest Plot': './r_tmp/forest.png'}, 'texts': {'Cumulative Summary': 'Binary Fixed-effect Model - Peto\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Gonzalez            0.571       0.170         1.916         0.617        NA    \n\n + Prins             0.522       0.219         1.246         0.444      0.143   \n\n + Giamarellou       0.407       0.188         0.881         0.394      0.022   \n\n + Maller            0.779       0.458         1.325         0.271      0.357   \n\n + Sturm             0.736       0.439         1.234         0.264      0.245   \n\n + Marik             0.547       0.379         0.790         0.187      0.001   \n\n + Muijsken          0.603       0.424         0.856         0.179      0.005   \n\n + Vigano            0.617       0.435         0.873         0.177      0.006   \n\n + Hansen            0.566       0.405         0.791         0.171     < 0.001  \n\n + De Vries          0.608       0.439         0.841         0.166      0.003   \n\n + Mauracher         0.575       0.419         0.789         0.162     < 0.001  \n\n + Nordstrom         0.578       0.424         0.789         0.159     < 0.001  \n\n + Rozdzinski        0.625       0.468         0.834         0.147      0.001   \n\n + Ter Braak         0.664       0.503         0.876         0.142      0.004   \n\n + Tulkens           0.665       0.504         0.877         0.141      0.004   \n\n + Van der Auwera    0.656       0.499         0.863         0.140      0.003   \n\n + Klastersky        0.722       0.552         0.943         0.137      0.017   \n\n + Vanhaeverbeek     0.723       0.553         0.944         0.136      0.017   \n\n + Hollender         0.718       0.550         0.937         0.136      0.015   \n\n\n'}, 'image_var_names': {'cumulative forest plot': 'cumulative_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371576749.90466'}, 'image_order': None},
                          })
    method_and_params.append({'meta_f_str': "cum.ma.binary",
                              'method'    : "binary.fixed.mh",
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Cumulative Forest Plot': './r_tmp/forest.png'}, 'texts': {'Cumulative Summary': 'Binary Fixed-effect Model - Mantel Haenszel\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Gonzalez            0.571       0.170         1.916         0.617        NA    \n\n + Prins             0.507       0.203         1.263         0.466      0.145   \n\n + Giamarellou       0.369       0.156         0.875         0.440      0.024   \n\n + Maller            0.775       0.453         1.327         0.274      0.353   \n\n + Sturm             0.727       0.428         1.235         0.270      0.239   \n\n + Marik             0.539       0.370         0.786         0.193      0.001   \n\n + Muijsken          0.598       0.418         0.854         0.182      0.005   \n\n + Vigano            0.610       0.428         0.870         0.181      0.006   \n\n + Hansen            0.558       0.396         0.787         0.175     < 0.001  \n\n + De Vries          0.603       0.433         0.839         0.169      0.003   \n\n + Mauracher         0.566       0.408         0.784         0.167     < 0.001  \n\n + Nordstrom         0.569       0.413         0.784         0.163     < 0.001  \n\n + Rozdzinski        0.618       0.460         0.830         0.151      0.001   \n\n + Ter Braak         0.659       0.497         0.874         0.144      0.004   \n\n + Tulkens           0.659       0.497         0.874         0.144      0.004   \n\n + Van der Auwera    0.648       0.490         0.859         0.143      0.003   \n\n + Klastersky        0.718       0.547         0.942         0.139      0.017   \n\n + Vanhaeverbeek     0.718       0.547         0.942         0.139      0.017   \n\n + Hollender         0.712       0.543         0.934         0.138      0.014   \n\n\n'}, 'image_var_names': {'cumulative forest plot': 'cumulative_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371576826.62302'}, 'image_order': None},
                          })
    method_and_params.append({'meta_f_str': "cum.ma.binary",
                              'method'    : "binary.fixed.inv.var",
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Cumulative Forest Plot': './r_tmp/forest.png'}, 'texts': {'Cumulative Summary': 'Binary Fixed-effect Model - Inverse Variance\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error   p-Val  \n\n Gonzalez            0.571       0.170         1.916         0.617       NA   \n\n + Prins             0.509       0.204         1.273         0.467     0.149  \n\n + Giamarellou       0.430       0.180         1.032         0.446     0.059  \n\n + Maller            0.854       0.485         1.505         0.289     0.586  \n\n + Sturm             0.813       0.466         1.419         0.284     0.466  \n\n + Marik             0.562       0.381         0.829         0.199     0.004  \n\n + Muijsken          0.622       0.430         0.901         0.189     0.012  \n\n + Vigano            0.635       0.440         0.917         0.187     0.015  \n\n + Hansen            0.589       0.412         0.843         0.183     0.004  \n\n + De Vries          0.633       0.447         0.896         0.177     0.010  \n\n + Mauracher         0.614       0.435         0.867         0.176     0.006  \n\n + Nordstrom         0.616       0.440         0.863         0.172     0.005  \n\n + Rozdzinski        0.666       0.489         0.908         0.158     0.010  \n\n + Ter Braak         0.709       0.528         0.954         0.151     0.023  \n\n + Tulkens           0.711       0.529         0.955         0.151     0.023  \n\n + Van der Auwera    0.702       0.523         0.942         0.150     0.018  \n\n + Klastersky        0.764       0.573         1.018         0.147     0.066  \n\n + Vanhaeverbeek     0.765       0.574         1.019         0.146     0.067  \n\n + Hollender         0.760       0.571         1.011         0.146     0.059  \n\n\n'}, 'image_var_names': {'cumulative forest plot': 'cumulative_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371576934.50447'}, 'image_order': None},
                          })
    
    #### LEAVE ONE-OUT BINARY ######
    method_and_params.append({'meta_f_str': u'loo.ma.binary',
                              'method'    : 'binary.random',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Leave-one-out Forest Plot': './r_tmp/forest.png'}, 'texts': {'Leave-one-out Summary': 'Binary Random-Effects Model\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error   p-Val  \n\n Overall             0.770       0.485         1.222         0.236     0.267  \n\n - Gonzalez          0.783       0.477         1.285         0.253     0.332  \n\n - Prins             0.796       0.489         1.296         0.249     0.359  \n\n - Giamarellou       0.811       0.513         1.281         0.233     0.369  \n\n - Maller            0.715       0.437         1.172         0.252     0.184  \n\n - Sturm             0.791       0.494         1.265         0.240     0.327  \n\n - Marik             0.864       0.543         1.375         0.237     0.538  \n\n - Muijsken          0.724       0.446         1.175         0.247     0.191  \n\n - Vigano            0.750       0.468         1.200         0.240     0.230  \n\n - Hansen            0.851       0.542         1.336         0.230     0.484  \n\n - De Vries          0.724       0.449         1.166         0.243     0.184  \n\n - Mauracher         0.813       0.515         1.283         0.233     0.375  \n\n - Nordstrom         0.772       0.474         1.257         0.249     0.298  \n\n - Rozdzinski        0.738       0.442         1.231         0.261     0.244  \n\n - Ter Braak         0.726       0.443         1.189         0.252     0.204  \n\n - Tulkens           0.764       0.476         1.227         0.242     0.266  \n\n - Van der Auwera    0.791       0.494         1.265         0.240     0.327  \n\n - Klastersky        0.696       0.458         1.059         0.214     0.091  \n\n - Vanhaeverbeek     0.764       0.476         1.226         0.242     0.265  \n\n - Hollender         0.780       0.486         1.253         0.241     0.304  \n\n\n'}, 'image_var_names': {'loo forest plot': 'loo_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371578321.65222'}, 'image_order': None},
                      })
    method_and_params.append({'meta_f_str': u'loo.ma.binary',
                              'method'    : 'binary.fixed.peto',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Leave-one-out Forest Plot': './r_tmp/forest.png'}, 'texts': {'Leave-one-out Summary': 'Binary Fixed-effect Model - Peto\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error   p-Val  \n\n Overall             0.718       0.550         0.937         0.136     0.015  \n\n - Gonzalez          0.726       0.553         0.954         0.139     0.022  \n\n - Prins             0.732       0.558         0.961         0.139     0.025  \n\n - Giamarellou       0.746       0.570         0.977         0.138     0.033  \n\n - Maller            0.649       0.487         0.863         0.146     0.003  \n\n - Sturm             0.728       0.557         0.952         0.137     0.020  \n\n - Marik             0.878       0.645         1.197         0.158     0.411  \n\n - Muijsken          0.687       0.523         0.903         0.139     0.007  \n\n - Vigano            0.710       0.543         0.927         0.136     0.012  \n\n - Hansen            0.766       0.583         1.006         0.139     0.055  \n\n - De Vries          0.690       0.526         0.905         0.139     0.007  \n\n - Mauracher         0.752       0.574         0.985         0.138     0.039  \n\n - Nordstrom         0.720       0.549         0.943         0.138     0.017  \n\n - Rozdzinski        0.686       0.517         0.911         0.144     0.009  \n\n - Ter Braak         0.683       0.518         0.901         0.141     0.007  \n\n - Tulkens           0.717       0.549         0.936         0.136     0.014  \n\n - Van der Auwera    0.728       0.557         0.952         0.137     0.020  \n\n - Klastersky        0.654       0.498         0.859         0.139     0.002  \n\n - Vanhaeverbeek     0.717       0.549         0.936         0.136     0.014  \n\n - Hollender         0.723       0.553         0.944         0.136     0.017  \n\n\n'}, 'image_var_names': {'loo forest plot': 'loo_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371578645.56023'}, 'image_order': None},
                      })
    method_and_params.append({'meta_f_str': u'loo.ma.binary',
                              'method'    : 'binary.fixed.mh',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Leave-one-out Forest Plot': './r_tmp/forest.png'}, 'texts': {'Leave-one-out Summary': 'Binary Fixed-effect Model - Mantel Haenszel\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error   p-Val  \n\n Overall             0.712       0.543         0.934         0.138     0.014  \n\n - Gonzalez          0.720       0.545         0.951         0.142     0.021  \n\n - Prins             0.727       0.551         0.959         0.141     0.024  \n\n - Giamarellou       0.742       0.564         0.975         0.140     0.032  \n\n - Maller            0.639       0.476         0.857         0.150     0.003  \n\n - Sturm             0.724       0.551         0.950         0.139     0.020  \n\n - Marik             0.874       0.637         1.199         0.161     0.403  \n\n - Muijsken          0.680       0.514         0.899         0.143     0.007  \n\n - Vigano            0.704       0.536         0.924         0.139     0.012  \n\n - Hansen            0.760       0.576         1.003         0.142     0.053  \n\n - De Vries          0.683       0.517         0.901         0.142     0.007  \n\n - Mauracher         0.748       0.568         0.984         0.140     0.038  \n\n - Nordstrom         0.713       0.542         0.939         0.140     0.016  \n\n - Rozdzinski        0.678       0.508         0.906         0.148     0.009  \n\n - Ter Braak         0.675       0.509         0.896         0.144     0.007  \n\n - Tulkens           0.712       0.543         0.934         0.138     0.014  \n\n - Van der Auwera    0.724       0.551         0.950         0.139     0.020  \n\n - Klastersky        0.643       0.486         0.851         0.143     0.002  \n\n - Vanhaeverbeek     0.712       0.543         0.934         0.138     0.014  \n\n - Hollender         0.718       0.547         0.942         0.139     0.017  \n\n\n'}, 'image_var_names': {'loo forest plot': 'loo_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371578738.91666'}, 'image_order': None},
                      })
    method_and_params.append({'meta_f_str': u'loo.ma.binary',
                              'method'    : 'binary.fixed.inv.var',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': True, 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'OR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True},
                              'results'   : {'images': {'Leave-one-out Forest Plot': './r_tmp/forest.png'}, 'texts': {'Leave-one-out Summary': 'Binary Fixed-effect Model - Inverse Variance\n\nMetric: Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error   p-Val  \n\n Overall             0.760       0.571         1.011         0.146     0.059  \n\n - Gonzalez          0.772       0.576         1.037         0.150     0.085  \n\n - Prins             0.778       0.581         1.042         0.149     0.092  \n\n - Giamarellou       0.776       0.583         1.035         0.147     0.084  \n\n - Maller            0.683       0.501         0.931         0.158     0.016  \n\n - Sturm             0.769       0.577         1.025         0.147     0.073  \n\n - Marik             0.975       0.697         1.364         0.171     0.882  \n\n - Muijsken          0.725       0.540         0.974         0.150     0.033  \n\n - Vigano            0.752       0.564         1.001         0.146     0.051  \n\n - Hansen            0.802       0.600         1.073         0.148     0.137  \n\n - De Vries          0.730       0.545         0.977         0.149     0.034  \n\n - Mauracher         0.777       0.583         1.036         0.147     0.086  \n\n - Nordstrom         0.763       0.571         1.020         0.148     0.068  \n\n - Rozdzinski        0.726       0.534         0.987         0.157     0.041  \n\n - Ter Braak         0.721       0.535         0.972         0.152     0.032  \n\n - Tulkens           0.758       0.569         1.010         0.146     0.059  \n\n - Van der Auwera    0.769       0.577         1.025         0.147     0.073  \n\n - Klastersky        0.699       0.522         0.936         0.149     0.016  \n\n - Vanhaeverbeek     0.758       0.569         1.010         0.146     0.058  \n\n - Hollender         0.765       0.574         1.019         0.146     0.067  \n\n\n'}, 'image_var_names': {'loo forest plot': 'loo_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371578803.22466'}, 'image_order': None},
                      })
    
    
    # for now just check that images and texts match
    for t in method_and_params:
        check_binary_meta_method_analysis.description = "Testing Binary Meta Method Analysis %s:%s" % (t['meta_f_str'], t['method'])
        yield check_binary_meta_method_analysis, t
    
####################################################
#    method_and_params.append({'meta_f_str': "",
#                              'method'    : "",
#                              'parameters': ,
#                              'results'   : ,
#                      })
####################################################
    

        
def check_binary_meta_analysis(test_data):
    test_result = meta_py_r.run_binary_ma(test_data['method'], test_data['parameters'])
    _results_match(test_result, test_data['results'], ['images',]) #,'texts'])
    
def check_binary_meta_method_analysis(test_data):
    test_result = meta_py_r.run_meta_method(test_data['meta_f_str'], test_data['method'], test_data['parameters'])
    _results_match(test_result, test_data['results'], ['images',]) #,'texts'])
    
def _results_match(test_res, ref_res, keys_to_compare): # test results and reference results
    for key in keys_to_compare:
        assert ((key in test_res) and (key in ref_res)), "key %s not found in test_result dictionary" % key
        val_ref, val_test = ref_res[key], test_res[key]
        
        equal_values = _compare_values(val_ref, val_test)
        
        assert equal_values, "test value: %s does not match reference value: %s for key: %s" % (val_test, val_ref, key)
        
        
################# CONTINUOUS META ANALYSIS TESTS #############################

def test_continuous_meta_analysis():
    fullpath = os.path.join(os.getcwd(),"../sample_data", "continuous.oma")
    meta.open(fullpath)
    app.processEvents() #show the data
    meta_py_r.ma_dataset_to_simple_continuous_robj(meta.model)
    
    method_and_params = []
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': 'continuous.random',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': False, 'fp_xlabel': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': False, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'SMD', 'fp_show_summary_line': True},
                              'results': {'images': {'Forest Plot': './r_tmp/forest.png'}, 'texts': {'Weights': 'studies      weights\nCarroll 1997 15.8%\nGrant   1981 16.3%\nPeck    1987 12.6%\nDonat   2003 23.3%\nStewart 1990 13.8%\nYoung   1995 18.3%\n', 'Summary': 'Continuous Random-Effects Model\n\nMetric: Standardized Mean Difference\n\n Model Results\n\n Estimate  Lower bound   Upper bound   Std. error   p-Value  \n\n 0.358        0.152         0.565         0.105     < 0.001  \n\n\n Heterogeneity\n\n tau^2  Q(df=5)   Het. p-Value   I^2  \n\n 0.037   11.914       0.036      58%  \n\n\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371651937.75495'}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': 'continuous.fixed',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': False, 'fp_xlabel': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': False, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'SMD', 'fp_show_summary_line': True},
                              'results': {'images': {'Forest Plot': './r_tmp/forest.png'}, 'texts': {'Weights': 'studies      weights\nCarroll 1997 12.4%\nGrant   1981 13.3%\nPeck    1987  8.1%\nDonat   2003 39.2%\nStewart 1990  9.5%\nYoung   1995 17.5%\n', 'Summary': 'Continuous Fixed-Effect Model\n\nMetric: Standardized Mean Difference\n\n Model Results\n\n Estimate  Lower bound   Upper bound   Std. error   p-Value  \n\n 0.415        0.289         0.541         0.064     < 0.001  \n\n\n Heterogeneity\n\n Q(df=5)  Het. p-Value   I^2  \n\n 11.914       0.036      58%  \n\n\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371651942.7068'}, 'image_order': None},
                             })
    
    # for now just check that images and texts match
    for t in method_and_params:
        check_continuous_meta_analysis.description = "Testing Continuous Meta Analysis %s" % t['method']
        yield check_continuous_meta_analysis, t

def test_continuous_meta_analysis_meta_methods():
    fullpath = os.path.join(os.getcwd(),"../sample_data", "continuous.oma")
    meta.open(fullpath)
    app.processEvents() #show the data
    meta_py_r.ma_dataset_to_simple_continuous_robj(meta.model)
    
    method_and_params = []
    
    # Cumulative meta analysis
    method_and_params.append({
                              'meta_f_str': 'cum.ma.continuous',
                              'method': 'continuous.random',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': False, 'fp_xlabel': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': False, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'SMD', 'fp_show_summary_line': True},
                              'results': {'images': {'Cumulative Forest Plot': './r_tmp/forest.png'}, 'texts': {'Cumulative Summary': 'Continuous Random-Effects Model\n\nMetric: Standardized Mean Difference\n\n Model Results\n\n Studies    Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Carroll      0.095      -0.264         0.453         0.183        NA    \n\n + Grant      0.189      -0.059         0.438         0.127      0.136   \n\n + Peck       0.232       0.015         0.449         0.111      0.036   \n\n + Donat      0.376       0.091         0.660         0.145      0.010   \n\n + Stewart    0.397       0.169         0.626         0.116     < 0.001  \n\n + Young      0.358       0.152         0.565         0.105     < 0.001  \n\n\n'}, 'image_var_names': {'cumulative forest plot': 'cumulative forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371655521.74068'}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'cum.ma.continuous',
                              'method': 'continuous.fixed',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': False, 'fp_xlabel': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': False, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'SMD', 'fp_show_summary_line': True},
                              'results': {'images': {'Cumulative Forest Plot': './r_tmp/forest.png'}, 'texts': {'Cumulative Summary': 'Continuous Fixed-effect Model - Inverse Variance\n\nMetric: Standardized Mean Difference\n\n Model Results\n\n Studies    Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Carroll      0.095      -0.264         0.453         0.183        NA    \n\n + Grant      0.189      -0.059         0.438         0.127      0.136   \n\n + Peck       0.232       0.015         0.449         0.111      0.036   \n\n + Donat      0.464       0.316         0.611         0.075     < 0.001  \n\n + Stewart    0.464       0.325         0.602         0.071     < 0.001  \n\n + Young      0.415       0.289         0.541         0.064     < 0.001  \n\n\n'}, 'image_var_names': {'cumulative forest plot': 'cumulative forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371655532.42571'}, 'image_order': None},
                             })
    
    # Leave one out meta analysis
    method_and_params.append({
                              'meta_f_str': 'loo.ma.continuous',
                              'method': 'continuous.random',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': False, 'fp_xlabel': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': False, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'SMD', 'fp_show_summary_line': True},
                              'results': {'images': {'Leave-one-out Forest Plot': './r_tmp/forest.png'}, 'texts': {'Leave-one-out Summary': 'Continuous Random-Effects Model\n\nMetric: Standardized Mean Difference\n\n Model Results\n\n Studies    Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall      0.358       0.152         0.565         0.105     < 0.001  \n\n - Carroll    0.411       0.202         0.621         0.107     < 0.001  \n\n - Grant      0.370       0.126         0.615         0.125      0.003   \n\n - Peck       0.353       0.113         0.593         0.122      0.004   \n\n - Donat      0.254       0.093         0.416         0.082      0.002   \n\n - Stewart    0.337       0.094         0.580         0.124      0.007   \n\n - Young      0.397       0.169         0.626         0.116     < 0.001  \n\n\n'}, 'image_var_names': {'loo forest plot': 'loo_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371655544.35331'}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'loo.ma.continuous',
                              'method': 'continuous.fixed',
                              'parameters': {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_show_col4': False, 'fp_xlabel': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_col3_str': u'Ev/Trt', 'fp_show_col3': False, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest.png', 'rm.method': 'DL', 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'SMD', 'fp_show_summary_line': True},
                              'results': {'images': {'Leave-one-out Forest Plot': './r_tmp/forest.png'}, 'texts': {'Leave-one-out Summary': 'Continuous Fixed-effect Model - Inverse Variance\n\nMetric: Standardized Mean Difference\n\n Model Results\n\n Studies    Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall      0.415       0.289         0.541         0.064     < 0.001  \n\n - Carroll    0.460       0.326         0.595         0.069     < 0.001  \n\n - Grant      0.436       0.301         0.571         0.069     < 0.001  \n\n - Peck       0.419       0.288         0.551         0.067     < 0.001  \n\n - Donat      0.254       0.093         0.416         0.082      0.002   \n\n - Stewart    0.410       0.278         0.543         0.068     < 0.001  \n\n - Young      0.464       0.325         0.602         0.071     < 0.001  \n\n\n'}, 'image_var_names': {'loo forest plot': 'loo_forest_plot'}, 'image_params_paths': {'Forest Plot': 'r_tmp/1371655554.24533'}, 'image_order': None},
                             })
    
    # for now just check that images and texts match
    for t in method_and_params:
        check_continuous_meta_method_analysis.description = "Testing Continuous Meta Method Analysis %s:%s" % (t['meta_f_str'], t['method'])
        yield check_continuous_meta_method_analysis, t


def check_continuous_meta_analysis(test_data):
    test_result = meta_py_r.run_continuous_ma(test_data['method'], test_data['parameters'])
    _results_match(test_result, test_data['results'], ['images',]) #,'texts'])

# same as check_binary_meta_method_analysis--> should be refactored together
def check_continuous_meta_method_analysis(test_data):
    test_result = meta_py_r.run_meta_method(test_data['meta_f_str'], test_data['method'], test_data['parameters'])
    _results_match(test_result, test_data['results'], ['images',]) #,'texts'])

####### DIAGNOSTIC META ANALYSIS #########


def test_multi_diagnostic_meta_analysis():
    fullpath = os.path.join(os.getcwd(),"../sample_data", "lymph.oma")
    meta.open(fullpath)
    app.processEvents() #show the data
    meta_py_r.ma_dataset_to_simple_diagnostic_robj(meta.model)
    
    method_and_params = []
    
    # coupled senss/spec, DOR/LR
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.bivariate.ml', 'diagnostic.bivariate.ml', 'diagnostic.random', 'diagnostic.random', 'diagnostic.random'],
                              'parameters': [{'conf.level': 95.0, 'fp_outpath': u'./r_tmp/forest_sens.png', 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_xlabel': u'[default]', 'fp_show_col1': True, 'fp_show_col2': True, 'fp_show_summary_line': True, 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_plot_lb': '[default]'}, {'conf.level': 95.0, 'fp_outpath': u'./r_tmp/forest_spec.png', 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_xlabel': u'[default]', 'fp_show_col1': True, 'fp_show_col2': True, 'fp_show_summary_line': True, 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_plot_lb': '[default]'}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'NLR and PLR Forest Plot': './r_tmp/forest_nlr.png', 'ROC Plot': './r_tmp/bivariate', 'Odds Ratio Forest Plot': './r_tmp/forest_dor.png'}, 'texts': {'Negative Likelihood Ratio Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nNegative Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.388        0.307         0.489      < 0.001  \n\n\nNegative Likelihood Ratio - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.087   29.646        0.020      46%  \n\n\nNegative Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.947      -1.180        -0.715         0.119    \n\n\n', 'Odds Ratio  Weights': 'studies             weights\nKinderman      1970  4.3%\nLecart Lenfant 1971  5.3%\nPiver          1971  4.4%\nPiver Barlow   1973  3.3%\nKolbenstvedt   1975 10.3%\nLehman         1975  5.3%\nBrown          1979  3.7%\nLagasse        1979  8.6%\nKjorstad       1980  7.9%\nAshraf         1982  5.0%\nDe Muylder     1984  7.9%\nSmales         1986  6.1%\nFeigen         1987  5.0%\nSwart          1989  7.2%\nHeller         1990  9.6%\nLa Fianza      1990  3.7%\nStellato       1992  2.5%\n', 'Negative Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  1.3%\nLecart Lenfant 1971  7.9%\nPiver          1971  1.3%\nPiver Barlow   1973  1.3%\nKolbenstvedt   1975 12.9%\nLehman         1975  5.6%\nBrown          1979  7.9%\nLagasse        1979  8.8%\nKjorstad       1980  8.3%\nAshraf         1982  5.3%\nDe Muylder     1984  6.2%\nSmales         1986  4.0%\nFeigen         1987  2.3%\nSwart          1989  6.0%\nHeller         1990 13.2%\nLa Fianza      1990  3.4%\nStellato       1992  4.2%\n', 'Positive Likelihood Ratio Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nPositive Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 3.245        2.437         4.322      < 0.001  \n\n\nPositive Likelihood Ratio - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.184   44.805      < 0.001      64%  \n\n\nPositive Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 1.177        0.891         1.464         0.146    \n\n\n', 'Odds Ratio Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nOdds Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 9.648        5.529         16.835     < 0.001  \n\n\nOdds Ratio - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.704   42.259      < 0.001      62%  \n\n\nOdds Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 2.267        1.710         2.823         0.284    \n\n\n', 'Positive Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  1.8%\nLecart Lenfant 1971  7.8%\nPiver          1971  1.8%\nPiver Barlow   1973  1.8%\nKolbenstvedt   1975 10.4%\nLehman         1975  6.1%\nBrown          1979  7.7%\nLagasse        1979  8.3%\nKjorstad       1980  8.0%\nAshraf         1982  5.9%\nDe Muylder     1984  6.6%\nSmales         1986  4.8%\nFeigen         1987  3.0%\nSwart          1989  6.5%\nHeller         1990 10.5%\nLa Fianza      1990  4.2%\nStellato       1992  4.9%\n', 'Bivariate Summary': '\n              Estimate   Lower bound   Upper bound  \n\n Sensitivity   0.6725       0.6076        0.7314    \n\n Specificity    0.838       0.7597        0.8944    \n\n Correlation   0.4433                               \n\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'NLR and PLR Forest Plot': 'r_tmp/1371821237.75145', 'Odds Ratio Forest Plot': 'r_tmp/1371821238.15521'}, 'image_order': ['ROC Plot', 'NLR and PLR Forest Plot', 'Odds Ratio Forest Plot']},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.bivariate.ml', 'diagnostic.bivariate.ml'],
                              'parameters': [{'conf.level': 95.0, 'fp_outpath': u'./r_tmp/forest_sens.png', 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_xlabel': u'[default]', 'fp_show_col1': True, 'fp_show_col2': True, 'fp_show_summary_line': True, 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_plot_lb': '[default]'}, {'conf.level': 95.0, 'fp_outpath': u'./r_tmp/forest_spec.png', 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_xlabel': u'[default]', 'fp_show_col1': True, 'fp_show_col2': True, 'fp_show_summary_line': True, 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_plot_lb': '[default]'}],
                              'results': {'images': {'ROC Plot': './r_tmp/bivariate'}, 'texts': {'Bivariate Summary': '\n              Estimate   Lower bound   Upper bound  \n\n Sensitivity   0.6725       0.6076        0.7314    \n\n Specificity    0.838       0.7597        0.8944    \n\n Correlation   0.4433                               \n\n'}, 'image_var_names': {}, 'image_params_paths': {}, 'image_order': ['ROC Plot']},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.hsroc', 'diagnostic.hsroc'],
                              'parameters': [{'conf.level': 95.0, 'burn.in': 1000.0, 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'theta.lower': -2.0, 'lambda.lower': -2.0, 'fp_xlabel': u'[default]', 'fp_col3_str': u'[default]', 'lambda.upper': 2.0, 'fp_show_summary_line': True, 'to': 'only0', 'num.iters': 2000.0, 'theta.upper': 2.0, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_sens.png', 'fp_col2_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'num.chains': 3.0, 'adjust': 0.5, 'thin': 2.0}, {'conf.level': 95.0, 'burn.in': 1000.0, 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'theta.lower': -2.0, 'lambda.lower': -2.0, 'fp_xlabel': u'[default]', 'fp_col3_str': u'[default]', 'lambda.upper': 2.0, 'fp_show_summary_line': True, 'to': 'only0', 'num.iters': 2000.0, 'theta.upper': 2.0, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_spec.png', 'fp_col2_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'num.chains': 3.0, 'adjust': 0.5, 'thin': 2.0}],
                              'results': {'images': {'Capital Theta': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_Capital Theta.png', 'Summary ROC': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Summary_ROC_curve.png', '~sigma[alpha]': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_~sigma[alpha].png', 'Capital Lambda': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_Capital Lambda.png', 'Sensitivity (new)': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_Sensitivity (new).png', 'Specificity (new)': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_Specificity (new).png', 'Sensitivity (summary)': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_Sensitivity (summary).png', 'beta': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_beta.png', '~sigma[theta]': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_~sigma[theta].png', 'Specificity (summary)': '/Users/george/git/OpenMeta-analyst-/r_tmp/1371822762.04477/Density_plots_for_N_1500_Specificity (summary).png'}, 'texts': {'Within-study parameters': ', , theta\n\n         median estimate   HPD lower HPD upper\nStudy 1       0.69803087  0.32552630 1.1150434\nStudy 2      -0.09297115 -0.55664184 0.3030164\nStudy 3       0.46171049  0.11490751 0.8715222\nStudy 4       0.38240062 -0.06103964 0.8918820\nStudy 5       0.20392136  0.06145839 0.3786286\nStudy 6       0.14935249 -0.33509209 0.7061886\nStudy 7      -0.16214394 -0.66935116 0.3914188\nStudy 8       0.19830070 -0.16746306 0.5196922\nStudy 9       0.07684786 -0.22506758 0.4245897\nStudy 10      0.12891246 -0.27993951 0.5589942\nStudy 11      0.49074656  0.13668562 0.7931144\nStudy 12      0.41713421 -0.12364000 0.7519144\nStudy 13      0.51304255  0.07023250 0.9846707\nStudy 14      0.30460908 -0.02568518 0.6027510\nStudy 15     -0.01442968 -0.31692350 0.2285859\nStudy 16      0.24233630 -0.26634554 0.6875052\nStudy 17      0.09272226 -0.48864714 0.5685633\n\n, , alpha\n\n         median estimate   HPD lower HPD upper\nStudy 1        2.2758339  1.58967713  3.096629\nStudy 2        1.0845097  0.32934381  1.903045\nStudy 3        2.3673433  1.72924631  3.074948\nStudy 4        1.8379193  0.94154033  2.885947\nStudy 5        0.8913593  0.51995271  1.260352\nStudy 6        1.6858899  0.94851714  2.669716\nStudy 7        0.9551123 -0.02771189  1.934224\nStudy 8        1.0331770  0.47276131  1.524064\nStudy 9        1.0455482  0.42497517  1.641060\nStudy 10       1.2619822  0.45133571  2.030991\nStudy 11       1.1096031  0.52601622  1.746977\nStudy 12       1.9478753  1.13570219  2.651191\nStudy 13       0.8116051 -0.06481452  1.586634\nStudy 14       0.8809636  0.22110373  1.624977\nStudy 15       1.3608423  0.95642373  1.730904\nStudy 16       2.1586610  1.26009496  3.156268\nStudy 17       1.7320566  0.74505269  2.892451\n\n, , pi\n\n         median estimate  HPD lower HPD upper\nStudy 1        0.2630596 0.18730478 0.3470781\nStudy 2        0.3200779 0.16923363 0.4674571\nStudy 3        0.5151677 0.42501417 0.6135141\nStudy 4        0.2760571 0.11425434 0.4413790\nStudy 5        0.2564952 0.20506342 0.3077615\nStudy 6        0.2154624 0.11670316 0.3347601\nStudy 7        0.2967362 0.13615389 0.5014339\nStudy 8        0.2785146 0.19345296 0.3733077\nStudy 9        0.4112198 0.27976452 0.5233763\nStudy 10       0.1643176 0.07160486 0.2758295\nStudy 11       0.1847000 0.10637982 0.2557690\nStudy 12       0.1986898 0.11558874 0.2906376\nStudy 13       0.2310334 0.11268643 0.3667132\nStudy 14       0.2629892 0.14087820 0.3776758\nStudy 15       0.2336932 0.18349034 0.2906502\nStudy 16       0.1941676 0.09829658 0.3060775\nStudy 17       0.2123198 0.06038982 0.3829499\n\n, , S1\n\n         median estimate HPD lower HPD upper\nStudy 1        0.6683118 0.5164791 0.8314649\nStudy 2        0.7310770 0.5501698 0.9364585\nStudy 3        0.7640031 0.6445233 0.8677855\nStudy 4        0.7040620 0.4781788 0.9207590\nStudy 5        0.5942840 0.5011909 0.6930903\nStudy 6        0.7491683 0.5394380 0.9513100\nStudy 7        0.7314209 0.4735210 0.9486799\nStudy 8        0.6236479 0.4593516 0.7856192\nStudy 9        0.6684586 0.5075052 0.8049522\nStudy 10       0.6877392 0.4645535 0.8939442\nStudy 11       0.5328886 0.3368038 0.7085752\nStudy 12       0.7095160 0.5178982 0.8824316\nStudy 13       0.4512276 0.2105432 0.7074230\nStudy 14       0.5533975 0.3606585 0.7472543\nStudy 15       0.7559136 0.6588032 0.8533911\nStudy 16       0.8016310 0.5920740 0.9695589\nStudy 17       0.7793028 0.5600778 0.9848306\n\n, , C1\n\n         median estimate HPD lower HPD upper\nStudy 1        0.9658261 0.9205495 0.9981404\nStudy 2        0.6738911 0.4735593 0.8114550\nStudy 3        0.9475733 0.8887872 0.9963107\nStudy 4        0.9017883 0.7936222 0.9903174\nStudy 5        0.7431712 0.6915009 0.7947100\nStudy 6        0.8405077 0.7242272 0.9246972\nStudy 7        0.6170629 0.3883184 0.8058288\nStudy 8        0.7559694 0.6638369 0.8484114\nStudy 9        0.7234265 0.5885812 0.8447218\nStudy 10       0.7727707 0.6533098 0.8831222\nStudy 11       0.8483912 0.7729611 0.9113318\nStudy 12       0.9148332 0.8483659 0.9739802\nStudy 13       0.8177595 0.6803237 0.9327431\nStudy 14       0.7674495 0.6502451 0.8734241\nStudy 15       0.7425736 0.6795000 0.7977407\nStudy 16       0.9033693 0.8108514 0.9723264\nStudy 17       0.8295944 0.6856259 0.9601372\n\n', 'Between-study parameters': '                      median estimate     HPD.low  HPD.high\nTHETA                      0.23194359 -0.03545655 0.5141692\nLAMBDA                     1.45066048  1.03033330 1.8921389\nbeta                       0.02800069 -0.60745888 0.4997070\nsigma.alpha                0.67955472  0.36645599 1.0931359\nsigma.theta                0.30348043  0.13732585 0.5056393\nSensitivity (summary)      0.68420054  0.58864326 0.7905390\nSpecificity (summary)      0.83121626  0.76871579 0.8979414\nSensitivity (new)          0.69073345  0.36747028 0.9987374\nSpecificity (new)          0.82923296  0.55193691 0.0000000\n'}, 'image_var_names': {}, 'image_params_paths': {}, 'image_order': ['Summary ROC', 'Capital Theta', 'Capital Lambda', 'beta', '~sigma[alpha]', '~sigma[theta]', 'Sensitivity (summary)', 'Specificity (summary)', 'Sensitivity (new)', 'Specificity (new)']},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.random', 'diagnostic.random'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_sens.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'to': 'only0', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_spec.png', 'rm.method': 'DL', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'Sensitivity and Specificity Forest Plot': './r_tmp/forest_sens.png', 'SROC': './r_tmp/roc.png'}, 'texts': {'Sensitivity  Weights': 'studies             weights\nKinderman      1970  8.9%\nLecart Lenfant 1971  3.3%\nPiver          1971 10.6%\nPiver Barlow   1973  3.0%\nKolbenstvedt   1975 13.8%\nLehman         1975  3.3%\nBrown          1979  1.9%\nLagasse        1979  8.8%\nKjorstad       1980  8.0%\nAshraf         1982  2.9%\nDe Muylder     1984  7.1%\nSmales         1986  5.3%\nFeigen         1987  3.2%\nSwart          1989  6.1%\nHeller         1990 10.7%\nLa Fianza      1990  2.0%\nStellato       1992  1.1%\n', 'Specificity  Weights': 'studies             weights\nKinderman      1970  2.2%\nLecart Lenfant 1971  6.2%\nPiver          1971  2.2%\nPiver Barlow   1973  2.2%\nKolbenstvedt   1975  9.7%\nLehman         1975  6.1%\nBrown          1979  5.3%\nLagasse        1979  8.2%\nKjorstad       1980  7.1%\nAshraf         1982  6.5%\nDe Muylder     1984  7.7%\nSmales         1986  5.3%\nFeigen         1987  5.6%\nSwart          1989  7.1%\nHeller         1990  9.5%\nLa Fianza      1990  4.5%\nStellato       1992  4.6%\n', 'Sensitivity Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nSensitivity - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.666        0.594         0.732      < 0.001  \n\n\nSensitivity - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.131   24.747        0.074      35%  \n\n\nSensitivity - Results (logit scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 0.690        0.379         1.002         0.159    \n\n\n', 'Specificity Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nSpecificity - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.802        0.744         0.849      < 0.001  \n\n\nSpecificity - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.274   51.543      < 0.001      69%  \n\n\nSpecificity - Results (logit scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 1.398        1.066         1.731         0.169    \n\n\n'}, 'image_var_names': {'sroc': 'sroc', 'forest plot': 'forest.plot'}, 'image_params_paths': {'Sensitivity and Specificity Forest Plot': 'r_tmp/1371821313.39885', 'SROC': 'r_tmp/1371821313.44903'}, 'image_order': ['Sensitivity and Specificity Forest Plot', 'SROC']},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_xlabel': u'[default]', 'fp_show_col1': True, 'fp_show_col2': True, 'fp_outpath': u'./r_tmp/forest_sens.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_plot_lb': '[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_xlabel': u'[default]', 'fp_show_col1': True, 'fp_show_col2': True, 'fp_outpath': u'./r_tmp/forest_spec.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_plot_lb': '[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'Sensitivity and Specificity Forest Plot': './r_tmp/forest_sens.png', 'SROC': './r_tmp/roc.png'}, 'texts': {'Sensitivity  Weights': 'studies             weights\nKinderman      1970  8.6%\nLecart Lenfant 1971  2.1%\nPiver          1971 12.2%\nPiver Barlow   1973  1.9%\nKolbenstvedt   1975 24.6%\nLehman         1975  2.1%\nBrown          1979  1.1%\nLagasse        1979  8.3%\nKjorstad       1980  7.0%\nAshraf         1982  1.8%\nDe Muylder     1984  5.8%\nSmales         1986  3.8%\nFeigen         1987  2.0%\nSwart          1989  4.6%\nHeller         1990 12.4%\nLa Fianza      1990  1.2%\nStellato       1992  0.6%\n', 'Specificity  Weights': 'studies             weights\nKinderman      1970  0.6%\nLecart Lenfant 1971  3.5%\nPiver          1971  0.6%\nPiver Barlow   1973  0.6%\nKolbenstvedt   1975 27.9%\nLehman         1975  3.3%\nBrown          1979  2.4%\nLagasse        1979  8.3%\nKjorstad       1980  4.9%\nAshraf         1982  3.9%\nDe Muylder     1984  6.7%\nSmales         1986  2.4%\nFeigen         1987  2.7%\nSwart          1989  4.9%\nHeller         1990 23.7%\nLa Fianza      1990  1.8%\nStellato       1992  1.8%\n', 'Sensitivity Summary': 'Diagnostic Fixed-Effect Model - Inverse Variance (k = 17)\n\n Sensitivity - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.661        0.609         0.709      < 0.001  \n\n\n Sensitivity - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 24.747        0.074      35%  \n\n\n Sensitivity - Results (logit scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 0.667        0.442         0.891         0.115    \n\n\n', 'Specificity Summary': 'Diagnostic Fixed-Effect Model - Inverse Variance (k = 17)\n\n Specificity - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.766        0.736         0.793      < 0.001  \n\n\n Specificity - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 51.543      < 0.001      69%  \n\n\n Specificity - Results (logit scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 1.184        1.026         1.342         0.081    \n\n\n'}, 'image_var_names': {'sroc': 'sroc', 'forest plot': 'forest.plot'}, 'image_params_paths': {'Sensitivity and Specificity Forest Plot': 'r_tmp/1371821320.48602', 'SROC': 'r_tmp/1371821320.53119'}, 'image_order': ['Sensitivity and Specificity Forest Plot', 'SROC']},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.random', 'diagnostic.random', 'diagnostic.random'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'NLR and PLR Forest Plot': './r_tmp/forest_nlr.png', 'Odds Ratio Forest Plot': './r_tmp/forest_dor.png'}, 'texts': {'Negative Likelihood Ratio Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nNegative Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.388        0.307         0.489      < 0.001  \n\n\nNegative Likelihood Ratio - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.087   29.646        0.020      46%  \n\n\nNegative Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.947      -1.180        -0.715         0.119    \n\n\n', 'Odds Ratio Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nOdds Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 9.648        5.529         16.835     < 0.001  \n\n\nOdds Ratio - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.704   42.259      < 0.001      62%  \n\n\nOdds Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 2.267        1.710         2.823         0.284    \n\n\n', 'Negative Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  1.3%\nLecart Lenfant 1971  7.9%\nPiver          1971  1.3%\nPiver Barlow   1973  1.3%\nKolbenstvedt   1975 12.9%\nLehman         1975  5.6%\nBrown          1979  7.9%\nLagasse        1979  8.8%\nKjorstad       1980  8.3%\nAshraf         1982  5.3%\nDe Muylder     1984  6.2%\nSmales         1986  4.0%\nFeigen         1987  2.3%\nSwart          1989  6.0%\nHeller         1990 13.2%\nLa Fianza      1990  3.4%\nStellato       1992  4.2%\n', 'Positive Likelihood Ratio Summary': 'Diagnostic Random-Effects Model (k = 17)\n\nPositive Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 3.245        2.437         4.322      < 0.001  \n\n\nPositive Likelihood Ratio - Heterogeneity\n\n tau^2  Q(df=16)   Het. p-Value   I^2  \n\n 0.184   44.805      < 0.001      64%  \n\n\nPositive Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 1.177        0.891         1.464         0.146    \n\n\n', 'Odds Ratio  Weights': 'studies             weights\nKinderman      1970  4.3%\nLecart Lenfant 1971  5.3%\nPiver          1971  4.4%\nPiver Barlow   1973  3.3%\nKolbenstvedt   1975 10.3%\nLehman         1975  5.3%\nBrown          1979  3.7%\nLagasse        1979  8.6%\nKjorstad       1980  7.9%\nAshraf         1982  5.0%\nDe Muylder     1984  7.9%\nSmales         1986  6.1%\nFeigen         1987  5.0%\nSwart          1989  7.2%\nHeller         1990  9.6%\nLa Fianza      1990  3.7%\nStellato       1992  2.5%\n', 'Positive Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  1.8%\nLecart Lenfant 1971  7.8%\nPiver          1971  1.8%\nPiver Barlow   1973  1.8%\nKolbenstvedt   1975 10.4%\nLehman         1975  6.1%\nBrown          1979  7.7%\nLagasse        1979  8.3%\nKjorstad       1980  8.0%\nAshraf         1982  5.9%\nDe Muylder     1984  6.6%\nSmales         1986  4.8%\nFeigen         1987  3.0%\nSwart          1989  6.5%\nHeller         1990 10.5%\nLa Fianza      1990  4.2%\nStellato       1992  4.9%\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'NLR and PLR Forest Plot': 'r_tmp/1371821329.96505', 'Odds Ratio Forest Plot': 'r_tmp/1371821330.34862'}, 'image_order': ['NLR and PLR Forest Plot', 'Odds Ratio Forest Plot']},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.fixed.mh', 'diagnostic.fixed.mh', 'diagnostic.fixed.mh'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'NLR and PLR Forest Plot': './r_tmp/forest_nlr.png', 'Odds Ratio Forest Plot': './r_tmp/forest_dor.png'}, 'texts': {'Negative Likelihood Ratio Summary': 'Diagnostic Fixed-Effect Model - Mantel Haenszel\n\n Negative Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.416        0.359         0.483      < 0.001  \n\n\n Negative Likelihood Ratio - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 37.747        0.002      58%  \n\n\n Negative Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.876      -1.024        -0.728         0.075    \n\n\n', 'Odds Ratio Summary': 'Diagnostic Fixed-Effect Model - Mantel Haenszel\n\n Odds Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 7.983        6.069         10.501     < 0.001  \n\n\n Odds Ratio - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 43.332      < 0.001      63%  \n\n\n Odds Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 2.077        1.803         2.352         0.140    \n\n\n', 'Negative Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  7.7%\nLecart Lenfant 1971  1.2%\nPiver          1971  7.8%\nPiver Barlow   1973  1.4%\nKolbenstvedt   1975 25.6%\nLehman         1975  1.3%\nBrown          1979  0.6%\nLagasse        1979  8.9%\nKjorstad       1980  5.3%\nAshraf         1982  1.5%\nDe Muylder     1984 10.9%\nSmales         1986  2.8%\nFeigen         1987 10.3%\nSwart          1989  6.4%\nHeller         1990  7.5%\nLa Fianza      1990  0.6%\nStellato       1992  0.3%\n', 'Positive Likelihood Ratio Summary': 'Diagnostic Fixed-Effect Model - Mantel Haenszel\n\n Positive Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 3.368        2.900         3.910      < 0.001  \n\n\n Positive Likelihood Ratio - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 53.126      < 0.001      70%  \n\n\n Positive Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 1.214        1.065         1.364         0.076    \n\n\n', 'Odds Ratio  Weights': 'studies             weights\nKinderman      1970  2.0%\nLecart Lenfant 1971  2.8%\nPiver          1971  2.0%\nPiver Barlow   1973  1.3%\nKolbenstvedt   1975 29.8%\nLehman         1975  2.8%\nBrown          1979  1.6%\nLagasse        1979  9.7%\nKjorstad       1980  7.2%\nAshraf         1982  2.5%\nDe Muylder     1984  7.1%\nSmales         1986  3.7%\nFeigen         1987  2.5%\nSwart          1989  5.5%\nHeller         1990 17.2%\nLa Fianza      1990  1.5%\nStellato       1992  0.9%\n', 'Positive Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  0.5%\nLecart Lenfant 1971  5.9%\nPiver          1971  0.5%\nPiver Barlow   1973  0.5%\nKolbenstvedt   1975 24.5%\nLehman         1975  3.3%\nBrown          1979  5.9%\nLagasse        1979  7.4%\nKjorstad       1980  6.5%\nAshraf         1982  3.0%\nDe Muylder     1984  3.8%\nSmales         1986  2.1%\nFeigen         1987  1.0%\nSwart          1989  3.7%\nHeller         1990 27.6%\nLa Fianza      1990  1.7%\nStellato       1992  2.1%\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'NLR and PLR Forest Plot': 'r_tmp/1371821337.39963', 'Odds Ratio Forest Plot': 'r_tmp/1371821337.78541'}, 'image_order': ['NLR and PLR Forest Plot', 'Odds Ratio Forest Plot']},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'None',
                              'method': ['diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'NLR and PLR Forest Plot': './r_tmp/forest_nlr.png', 'Odds Ratio Forest Plot': './r_tmp/forest_dor.png'}, 'texts': {'Negative Likelihood Ratio Summary': 'Diagnostic Fixed-Effect Model - Inverse Variance (k = 17)\n\n Negative Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 0.398        0.345         0.459      < 0.001  \n\n\n Negative Likelihood Ratio - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 29.646        0.020      46%  \n\n\n Negative Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n -0.922      -1.065        -0.778         0.073    \n\n\n', 'Odds Ratio Summary': 'Diagnostic Fixed-Effect Model - Inverse Variance (k = 17)\n\n Odds Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 6.825        5.074         9.181      < 0.001  \n\n\n Odds Ratio - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 42.259      < 0.001      62%  \n\n\n Odds Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 1.921        1.624         2.217         0.151    \n\n\n', 'Negative Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  0.5%\nLecart Lenfant 1971  5.9%\nPiver          1971  0.5%\nPiver Barlow   1973  0.5%\nKolbenstvedt   1975 24.5%\nLehman         1975  3.3%\nBrown          1979  5.9%\nLagasse        1979  7.4%\nKjorstad       1980  6.5%\nAshraf         1982  3.0%\nDe Muylder     1984  3.8%\nSmales         1986  2.1%\nFeigen         1987  1.0%\nSwart          1989  3.7%\nHeller         1990 27.6%\nLa Fianza      1990  1.7%\nStellato       1992  2.1%\n', 'Positive Likelihood Ratio Summary': 'Diagnostic Fixed-Effect Model - Inverse Variance (k = 17)\n\n Positive Likelihood Ratio - Model Results\n\n Estimate  Lower bound   Upper bound   p-Value  \n\n 2.726        2.361         3.147      < 0.001  \n\n\n Positive Likelihood Ratio - Heterogeneity\n\n Q(df=16)  Het. p-Value   I^2  \n\n 44.805      < 0.001      64%  \n\n\n Positive Likelihood Ratio - Results (log scale)\n\n Estimate  Lower bound   Upper bound   Std. error  \n\n 1.003        0.859         1.146         0.073    \n\n\n', 'Odds Ratio  Weights': 'studies             weights\nKinderman      1970  2.0%\nLecart Lenfant 1971  2.8%\nPiver          1971  2.0%\nPiver Barlow   1973  1.3%\nKolbenstvedt   1975 29.8%\nLehman         1975  2.8%\nBrown          1979  1.6%\nLagasse        1979  9.7%\nKjorstad       1980  7.2%\nAshraf         1982  2.5%\nDe Muylder     1984  7.1%\nSmales         1986  3.7%\nFeigen         1987  2.5%\nSwart          1989  5.5%\nHeller         1990 17.2%\nLa Fianza      1990  1.5%\nStellato       1992  0.9%\n', 'Positive Likelihood Ratio  Weights': 'studies             weights\nKinderman      1970  0.5%\nLecart Lenfant 1971  5.9%\nPiver          1971  0.5%\nPiver Barlow   1973  0.5%\nKolbenstvedt   1975 24.5%\nLehman         1975  3.3%\nBrown          1979  5.9%\nLagasse        1979  7.4%\nKjorstad       1980  6.5%\nAshraf         1982  3.0%\nDe Muylder     1984  3.8%\nSmales         1986  2.1%\nFeigen         1987  1.0%\nSwart          1989  3.7%\nHeller         1990 27.6%\nLa Fianza      1990  1.7%\nStellato       1992  2.1%\n'}, 'image_var_names': {'forest plot': 'forest_plot'}, 'image_params_paths': {'NLR and PLR Forest Plot': 'r_tmp/1371821345.29099', 'Odds Ratio Forest Plot': 'r_tmp/1371821345.68032'}, 'image_order': ['NLR and PLR Forest Plot', 'Odds Ratio Forest Plot']},
                             })
    
    # for now just check that images and texts match
    for t in method_and_params:
        check_diagnostic_multi_meta_analysis.description = "Testing Diagnostic Multi Meta Analysis %s" % t['method']
        yield check_diagnostic_multi_meta_analysis, t

def test_diagnostic_meta_analysis_meta_methods():
    fullpath = os.path.join(os.getcwd(),"../sample_data", "lymph.oma")
    meta.open(fullpath)
    app.processEvents() #show the data
    meta_py_r.ma_dataset_to_simple_diagnostic_robj(meta.model)
    
    method_and_params = []
    
    # Cumulative meta analysis
    method_and_params.append({
                              'meta_f_str': 'cum.ma.diagnostic',
                              'method': ['diagnostic.random', 'diagnostic.random'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_sens.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_spec.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'Spec Forest Plot': './r_tmp/forest_spec.png', 'Sens Forest Plot': './r_tmp/forest_sens.png'}, 'texts': {'Sensitivity Summary': 'Diagnostic Random-Effects\n\nMetric: Sensitivity\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman           0.655       0.469         0.803         0.391        NA    \n\n + Lecart Lenfant    0.687       0.525         0.814         0.350      0.024   \n\n + Piver             0.735       0.635         0.816         0.239     < 0.001  \n\n + Piver Barlow      0.734       0.637         0.812         0.230     < 0.001  \n\n + Kolbenstvedt      0.680       0.579         0.766         0.221     < 0.001  \n\n + Lehman            0.687       0.594         0.766         0.205     < 0.001  \n\n + Brown             0.689       0.603         0.764         0.193     < 0.001  \n\n + Lagasse           0.671       0.593         0.740         0.171     < 0.001  \n\n + Kjorstad          0.664       0.599         0.723         0.143     < 0.001  \n\n + Ashraf            0.662       0.600         0.719         0.137     < 0.001  \n\n + De Muylder        0.652       0.582         0.715         0.150     < 0.001  \n\n + Smales            0.653       0.590         0.711         0.138     < 0.001  \n\n + Feigen            0.646       0.570         0.714         0.161     < 0.001  \n\n + Swart             0.636       0.564         0.703         0.155     < 0.001  \n\n + Heller            0.656       0.583         0.722         0.159     < 0.001  \n\n + La Fianza         0.662       0.589         0.729         0.160     < 0.001  \n\n + Stellato          0.666       0.594         0.732         0.159     < 0.001  \n\n\n', 'Specificity Summary': 'Diagnostic Random-Effects\n\nMetric: Specificity\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman           0.988       0.919         0.998         1.006        NA    \n\n + Lecart Lenfant    0.907       0.159         0.998         2.011      0.257   \n\n + Piver             0.941       0.465         0.997         1.488      0.062   \n\n + Piver Barlow      0.941       0.634         0.993         1.137      0.015   \n\n + Kolbenstvedt      0.898       0.721         0.968         0.624     < 0.001  \n\n + Lehman            0.878       0.739         0.948         0.478     < 0.001  \n\n + Brown             0.837       0.686         0.923         0.437     < 0.001  \n\n + Lagasse           0.810       0.690         0.891         0.333     < 0.001  \n\n + Kjorstad          0.790       0.682         0.868         0.287     < 0.001  \n\n + Ashraf            0.782       0.686         0.855         0.254     < 0.001  \n\n + De Muylder        0.791       0.705         0.857         0.235     < 0.001  \n\n + Smales            0.811       0.728         0.872         0.239     < 0.001  \n\n + Feigen            0.810       0.734         0.868         0.223     < 0.001  \n\n + Swart             0.803       0.732         0.859         0.204     < 0.001  \n\n + Heller            0.792       0.730         0.843         0.175     < 0.001  \n\n + La Fianza         0.803       0.742         0.852         0.176     < 0.001  \n\n + Stellato          0.802       0.744         0.849         0.169     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'cum.ma.diagnostic',
                              'method': ['diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_sens.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_spec.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'Spec Forest Plot': './r_tmp/forest_spec.png', 'Sens Forest Plot': './r_tmp/forest_sens.png'}, 'texts': {'Sensitivity Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman           0.655       0.469         0.803         0.391        NA    \n\n + Lecart Lenfant    0.687       0.525         0.814         0.350      0.024   \n\n + Piver             0.735       0.635         0.816         0.239     < 0.001  \n\n + Piver Barlow      0.734       0.637         0.812         0.230     < 0.001  \n\n + Kolbenstvedt      0.664       0.589         0.731         0.163     < 0.001  \n\n + Lehman            0.670       0.597         0.735         0.160     < 0.001  \n\n + Brown             0.674       0.603         0.738         0.158     < 0.001  \n\n + Lagasse           0.661       0.594         0.723         0.147     < 0.001  \n\n + Kjorstad          0.662       0.599         0.720         0.139     < 0.001  \n\n + Ashraf            0.662       0.600         0.719         0.137     < 0.001  \n\n + De Muylder        0.646       0.585         0.703         0.132     < 0.001  \n\n + Smales            0.650       0.590         0.705         0.129     < 0.001  \n\n + Feigen            0.640       0.581         0.695         0.127     < 0.001  \n\n + Swart             0.633       0.575         0.687         0.124     < 0.001  \n\n + Heller            0.655       0.602         0.704         0.116     < 0.001  \n\n + La Fianza         0.659       0.606         0.707         0.115     < 0.001  \n\n + Stellato          0.661       0.609         0.709         0.115     < 0.001  \n\n\n', 'Specificity Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman           0.988       0.919         0.998         1.006        NA    \n\n + Lecart Lenfant    0.731       0.554         0.856         0.398      0.012   \n\n + Piver             0.800       0.660         0.892         0.370     < 0.001  \n\n + Piver Barlow      0.826       0.706         0.904         0.349     < 0.001  \n\n + Kolbenstvedt      0.756       0.701         0.803         0.140     < 0.001  \n\n + Lehman            0.764       0.714         0.808         0.133     < 0.001  \n\n + Brown             0.749       0.699         0.794         0.129     < 0.001  \n\n + Lagasse           0.750       0.705         0.791         0.117     < 0.001  \n\n + Kjorstad          0.745       0.701         0.784         0.112     < 0.001  \n\n + Ashraf            0.745       0.703         0.783         0.108     < 0.001  \n\n + De Muylder        0.759       0.721         0.794         0.102     < 0.001  \n\n + Smales            0.769       0.732         0.802         0.100     < 0.001  \n\n + Feigen            0.771       0.736         0.803         0.098     < 0.001  \n\n + Swart             0.770       0.735         0.801         0.095     < 0.001  \n\n + Heller            0.760       0.730         0.788         0.082     < 0.001  \n\n + La Fianza         0.765       0.735         0.792         0.081     < 0.001  \n\n + Stellato          0.766       0.736         0.793         0.081     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'cum.ma.diagnostic',
                              'method': ['diagnostic.random', 'diagnostic.random', 'diagnostic.random'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'DOR Forest Plot': './r_tmp/forest_dor.png', 'PLR Forest Plot': './r_tmp/forest_plr.png', 'NLR Forest Plot': './r_tmp/forest_nlr.png'}, 'texts': {'Negative Likelihood Ratio Summary': 'Diagnostic Random-Effects\n\nMetric: Negative Likelihood Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman           0.349       0.049         2.493         1.003        NA    \n\n + Lecart Lenfant    0.339       0.193         0.597         0.288     < 0.001  \n\n + Piver             0.329       0.191         0.567         0.277     < 0.001  \n\n + Piver Barlow      0.327       0.194         0.552         0.267     < 0.001  \n\n + Kolbenstvedt      0.494       0.384         0.638         0.130     < 0.001  \n\n + Lehman            0.410       0.290         0.580         0.177     < 0.001  \n\n + Brown             0.416       0.316         0.547         0.140     < 0.001  \n\n + Lagasse           0.450       0.359         0.564         0.115     < 0.001  \n\n + Kjorstad          0.464       0.383         0.564         0.099     < 0.001  \n\n + Ashraf            0.463       0.383         0.559         0.096     < 0.001  \n\n + De Muylder        0.473       0.394         0.568         0.093     < 0.001  \n\n + Smales            0.466       0.390         0.558         0.092     < 0.001  \n\n + Feigen            0.471       0.394         0.563         0.091     < 0.001  \n\n + Swart             0.480       0.404         0.571         0.089     < 0.001  \n\n + Heller            0.425       0.348         0.518         0.102     < 0.001  \n\n + La Fianza         0.409       0.329         0.508         0.111     < 0.001  \n\n + Stellato          0.388       0.307         0.489         0.119     < 0.001  \n\n\n', 'Positive Likelihood Ratio Summary': 'Diagnostic Random-Effects\n\nMetric: Positive Likelihood Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman          53.724       7.524        383.620        1.003        NA    \n\n + Lecart Lenfant    8.928       0.351        226.943        1.651      0.185   \n\n + Piver            13.895       1.152        167.657        1.271      0.038   \n\n + Piver Barlow     13.355       1.977         90.232        0.975      0.008   \n\n + Kolbenstvedt      6.265       2.408         16.302        0.488     < 0.001  \n\n + Lehman            5.636       2.579         12.317        0.399     < 0.001  \n\n + Brown             4.123       2.188         7.769         0.323     < 0.001  \n\n + Lagasse           3.482       2.096         5.785         0.259     < 0.001  \n\n + Kjorstad          3.110       2.022         4.784         0.220     < 0.001  \n\n + Ashraf            3.013       2.040         4.451         0.199     < 0.001  \n\n + De Muylder        2.968       2.082         4.230         0.181     < 0.001  \n\n + Smales            3.359       2.308         4.890         0.192     < 0.001  \n\n + Feigen            3.218       2.239         4.625         0.185     < 0.001  \n\n + Swart             3.063       2.187         4.288         0.172     < 0.001  \n\n + Heller            2.952       2.222         3.920         0.145     < 0.001  \n\n + La Fianza         3.195       2.376         4.295         0.151     < 0.001  \n\n + Stellato          3.245       2.437         4.322         0.146     < 0.001  \n\n\n', 'Odds Ratio Summary': 'Diagnostic Random-Effects\n\nMetric: Diagnostic Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman          153.900      18.557       1276.367       1.079        NA    \n\n + Lecart Lenfant   28.263       1.135        703.741        1.640      0.042   \n\n + Piver            49.827       5.056        491.074        1.167     < 0.001  \n\n + Piver Barlow     47.825       8.518        268.528        0.880     < 0.001  \n\n + Kolbenstvedt     25.967       4.462        151.105        0.899     < 0.001  \n\n + Lehman           24.368       5.627        105.520        0.748     < 0.001  \n\n + Brown            19.351       5.315         70.459        0.659     < 0.001  \n\n + Lagasse          14.183       5.176         38.859        0.514     < 0.001  \n\n + Kjorstad         11.491       4.886         27.023        0.436     < 0.001  \n\n + Ashraf           10.649       4.866         23.306        0.400     < 0.001  \n\n + De Muylder        9.341       4.690         18.603        0.351     < 0.001  \n\n + Smales           10.637       5.364         21.091        0.349     < 0.001  \n\n + Feigen            9.366       4.827         18.176        0.338     < 0.001  \n\n + Swart             8.414       4.538         15.599        0.315     < 0.001  \n\n + Heller            8.378       4.825         14.550        0.282     < 0.001  \n\n + La Fianza         9.333       5.305         16.419        0.288     < 0.001  \n\n + Stellato          9.648       5.529         16.835        0.284     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'cum.ma.diagnostic',
                              'method': ['diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'DOR Forest Plot': './r_tmp/forest_dor.png', 'PLR Forest Plot': './r_tmp/forest_plr.png', 'NLR Forest Plot': './r_tmp/forest_nlr.png'}, 'texts': {'Negative Likelihood Ratio Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman           0.349       0.049         2.493         1.003        NA    \n\n + Lecart Lenfant    0.339       0.193         0.597         0.288     < 0.001  \n\n + Piver             0.329       0.191         0.567         0.277     < 0.001  \n\n + Piver Barlow      0.327       0.194         0.552         0.267     < 0.001  \n\n + Kolbenstvedt      0.494       0.384         0.638         0.130     < 0.001  \n\n + Lehman            0.462       0.363         0.589         0.124     < 0.001  \n\n + Brown             0.445       0.356         0.557         0.114     < 0.001  \n\n + Lagasse           0.461       0.375         0.567         0.105     < 0.001  \n\n + Kjorstad          0.464       0.383         0.564         0.099     < 0.001  \n\n + Ashraf            0.463       0.383         0.559         0.096     < 0.001  \n\n + De Muylder        0.473       0.394         0.568         0.093     < 0.001  \n\n + Smales            0.466       0.390         0.558         0.092     < 0.001  \n\n + Feigen            0.471       0.394         0.563         0.091     < 0.001  \n\n + Swart             0.480       0.404         0.571         0.089     < 0.001  \n\n + Heller            0.417       0.360         0.483         0.075     < 0.001  \n\n + La Fianza         0.408       0.353         0.472         0.074     < 0.001  \n\n + Stellato          0.398       0.345         0.459         0.073     < 0.001  \n\n\n', 'Positive Likelihood Ratio Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman          53.724       7.524        383.620        1.003        NA    \n\n + Lecart Lenfant    2.572       1.461         4.526         0.288      0.001   \n\n + Piver             3.176       1.845         5.465         0.277     < 0.001  \n\n + Piver Barlow      3.520       2.086         5.940         0.267     < 0.001  \n\n + Kolbenstvedt      2.498       1.937         3.221         0.130     < 0.001  \n\n + Lehman            2.666       2.093         3.397         0.124     < 0.001  \n\n + Brown             2.471       1.975         3.091         0.114     < 0.001  \n\n + Lagasse           2.450       1.994         3.012         0.105     < 0.001  \n\n + Kjorstad          2.409       1.985         2.925         0.099     < 0.001  \n\n + Ashraf            2.426       2.009         2.930         0.096     < 0.001  \n\n + De Muylder        2.460       2.049         2.953         0.093     < 0.001  \n\n + Smales            2.578       2.153         3.085         0.092     < 0.001  \n\n + Feigen            2.554       2.136         3.052         0.091     < 0.001  \n\n + Swart             2.520       2.119         2.998         0.089     < 0.001  \n\n + Heller            2.626       2.268         3.040         0.075     < 0.001  \n\n + La Fianza         2.694       2.330         3.116         0.074     < 0.001  \n\n + Stellato          2.726       2.361         3.147         0.073     < 0.001  \n\n\n', 'Odds Ratio Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Kinderman          153.900      18.557       1276.367       1.079        NA    \n\n + Lecart Lenfant   22.268       5.737         86.438        0.692     < 0.001  \n\n + Piver            40.621       13.038       126.552        0.580     < 0.001  \n\n + Piver Barlow     41.295       14.580       116.956        0.531     < 0.001  \n\n + Kolbenstvedt      6.591       4.073         10.668        0.246     < 0.001  \n\n + Lehman            7.142       4.487         11.368        0.237     < 0.001  \n\n + Brown             7.014       4.445         11.068        0.233     < 0.001  \n\n + Lagasse           6.365       4.219         9.603         0.210     < 0.001  \n\n + Kjorstad          6.081       4.135         8.942         0.197     < 0.001  \n\n + Ashraf            6.088       4.173         8.881         0.193     < 0.001  \n\n + De Muylder        5.923       4.142         8.470         0.182     < 0.001  \n\n + Smales            6.480       4.574         9.181         0.178     < 0.001  \n\n + Feigen            6.174       4.383         8.696         0.175     < 0.001  \n\n + Swart             5.879       4.223         8.183         0.169     < 0.001  \n\n + Heller            6.443       4.772         8.699         0.153     < 0.001  \n\n + La Fianza         6.722       4.990         9.054         0.152     < 0.001  \n\n + Stellato          6.825       5.074         9.181         0.151     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {}, 'image_order': None},
                             })
    
    
    # Leave one out meta analysis
    method_and_params.append({
                              'meta_f_str': 'loo.ma.diagnostic',
                              'method': ['diagnostic.random', 'diagnostic.random'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_sens.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_spec.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'Sensitivity and Specificity Forest Plot': './r_tmp/forest_sens.png'}, 'texts': {'Sensitivity Summary': 'Diagnostic Random-Effects Model\n\nMetric: Sensitivity\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             0.666       0.594         0.732         0.159     < 0.001  \n\n - Kinderman         0.668       0.588         0.739         0.175     < 0.001  \n\n - Lecart Lenfant    0.661       0.586         0.728         0.163     < 0.001  \n\n - Piver             0.651       0.575         0.720         0.163     < 0.001  \n\n - Piver Barlow      0.665       0.589         0.733         0.166     < 0.001  \n\n - Kolbenstvedt      0.678       0.600         0.748         0.173     < 0.001  \n\n - Lehman            0.661       0.586         0.728         0.163     < 0.001  \n\n - Brown             0.662       0.588         0.729         0.162     < 0.001  \n\n - Lagasse           0.674       0.597         0.743         0.171     < 0.001  \n\n - Kjorstad          0.667       0.588         0.737         0.173     < 0.001  \n\n - Ashraf            0.666       0.591         0.735         0.166     < 0.001  \n\n - De Muylder        0.680       0.611         0.743         0.155     < 0.001  \n\n - Smales            0.664       0.586         0.733         0.168     < 0.001  \n\n - Feigen            0.676       0.611         0.735         0.146     < 0.001  \n\n - Swart             0.676       0.602         0.742         0.164     < 0.001  \n\n - Heller            0.648       0.574         0.715         0.158     < 0.001  \n\n - La Fianza         0.660       0.587         0.725         0.158     < 0.001  \n\n - Stellato          0.662       0.589         0.729         0.160     < 0.001  \n\n\n', 'Specificity Summary': 'Diagnostic Random-Effects Model\n\nMetric: Specificity\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             0.802       0.744         0.849         0.169     < 0.001  \n\n - Kinderman         0.788       0.732         0.834         0.156     < 0.001  \n\n - Lecart Lenfant    0.812       0.755         0.859         0.173     < 0.001  \n\n - Piver             0.791       0.733         0.838         0.162     < 0.001  \n\n - Piver Barlow      0.796       0.737         0.845         0.169     < 0.001  \n\n - Kolbenstvedt      0.813       0.747         0.865         0.197     < 0.001  \n\n - Lehman            0.800       0.738         0.850         0.177     < 0.001  \n\n - Brown             0.813       0.758         0.858         0.167     < 0.001  \n\n - Lagasse           0.808       0.746         0.858         0.185     < 0.001  \n\n - Kjorstad          0.810       0.750         0.858         0.179     < 0.001  \n\n - Ashraf            0.806       0.745         0.855         0.180     < 0.001  \n\n - De Muylder        0.797       0.735         0.848         0.177     < 0.001  \n\n - Smales            0.788       0.729         0.837         0.164     < 0.001  \n\n - Feigen            0.802       0.741         0.851         0.177     < 0.001  \n\n - Swart             0.807       0.746         0.856         0.181     < 0.001  \n\n - Heller            0.813       0.748         0.864         0.194     < 0.001  \n\n - La Fianza         0.792       0.733         0.841         0.168     < 0.001  \n\n - Stellato          0.803       0.742         0.852         0.176     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {'Sensitivity and Specificity Forest Plot': 'r_tmp/1371822165.0758'}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'loo.ma.diagnostic',
                              'method': ['diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_sens.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Sens', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_spec.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'Spec', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'Sensitivity and Specificity Forest Plot': './r_tmp/forest_sens.png'}, 'texts': {'Sensitivity Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             0.661       0.609         0.709         0.115     < 0.001  \n\n - Kinderman         0.661       0.607         0.712         0.120     < 0.001  \n\n - Lecart Lenfant    0.657       0.604         0.706         0.116     < 0.001  \n\n - Piver             0.643       0.586         0.696         0.122     < 0.001  \n\n - Piver Barlow      0.660       0.607         0.709         0.116     < 0.001  \n\n - Kolbenstvedt      0.684       0.626         0.737         0.132     < 0.001  \n\n - Lehman            0.657       0.604         0.706         0.116     < 0.001  \n\n - Brown             0.658       0.606         0.707         0.115     < 0.001  \n\n - Lagasse           0.668       0.614         0.718         0.120     < 0.001  \n\n - Kjorstad          0.660       0.606         0.710         0.119     < 0.001  \n\n - Ashraf            0.661       0.608         0.710         0.116     < 0.001  \n\n - De Muylder        0.673       0.620         0.722         0.118     < 0.001  \n\n - Smales            0.659       0.605         0.708         0.117     < 0.001  \n\n - Feigen            0.669       0.617         0.717         0.116     < 0.001  \n\n - Swart             0.668       0.615         0.717         0.117     < 0.001  \n\n - Heller            0.640       0.584         0.694         0.122     < 0.001  \n\n - La Fianza         0.657       0.604         0.706         0.115     < 0.001  \n\n - Stellato          0.659       0.606         0.707         0.115     < 0.001  \n\n\n', 'Specificity Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             0.766       0.736         0.793         0.081     < 0.001  \n\n - Kinderman         0.762       0.732         0.789         0.081     < 0.001  \n\n - Lecart Lenfant    0.771       0.741         0.798         0.082     < 0.001  \n\n - Piver             0.763       0.733         0.790         0.081     < 0.001  \n\n - Piver Barlow      0.764       0.734         0.791         0.081     < 0.001  \n\n - Kolbenstvedt      0.775       0.741         0.806         0.095     < 0.001  \n\n - Lehman            0.763       0.732         0.791         0.082     < 0.001  \n\n - Brown             0.771       0.742         0.798         0.082     < 0.001  \n\n - Lagasse           0.767       0.736         0.795         0.084     < 0.001  \n\n - Kjorstad          0.769       0.739         0.797         0.083     < 0.001  \n\n - Ashraf            0.766       0.736         0.794         0.082     < 0.001  \n\n - De Muylder        0.758       0.727         0.787         0.083     < 0.001  \n\n - Smales            0.759       0.729         0.787         0.082     < 0.001  \n\n - Feigen            0.764       0.734         0.792         0.082     < 0.001  \n\n - Swart             0.766       0.736         0.794         0.083     < 0.001  \n\n - Heller            0.776       0.743         0.806         0.092     < 0.001  \n\n - La Fianza         0.761       0.731         0.789         0.081     < 0.001  \n\n - Stellato          0.765       0.735         0.792         0.081     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {'Sensitivity and Specificity Forest Plot': 'r_tmp/1371822171.80419'}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'loo.ma.diagnostic',
                              'method': ['diagnostic.random', 'diagnostic.random', 'diagnostic.random'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'NLR and PLR Forest Plot': './r_tmp/forest_nlr.png', 'Odds Ratio Forest Plot': './r_tmp/forest_dor.png'}, 'texts': {'Negative Likelihood Ratio Summary': 'Diagnostic Random-Effects Model\n\nMetric: Negative Likelihood Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             0.388       0.307         0.489         0.119     < 0.001  \n\n - Kinderman         0.388       0.305         0.492         0.122     < 0.001  \n\n - Lecart Lenfant    0.391       0.304         0.502         0.128     < 0.001  \n\n - Piver             0.390       0.307         0.495         0.121     < 0.001  \n\n - Piver Barlow      0.388       0.306         0.493         0.122     < 0.001  \n\n - Kolbenstvedt      0.368       0.291         0.464         0.119     < 0.001  \n\n - Lehman            0.399       0.314         0.507         0.122     < 0.001  \n\n - Brown             0.389       0.303         0.500         0.128     < 0.001  \n\n - Lagasse           0.374       0.292         0.478         0.126     < 0.001  \n\n - Kjorstad          0.379       0.295         0.487         0.128     < 0.001  \n\n - Ashraf            0.384       0.300         0.491         0.126     < 0.001  \n\n - De Muylder        0.375       0.295         0.476         0.122     < 0.001  \n\n - Smales            0.391       0.307         0.498         0.124     < 0.001  \n\n - Feigen            0.380       0.301         0.481         0.120     < 0.001  \n\n - Swart             0.375       0.295         0.476         0.122     < 0.001  \n\n - Heller            0.408       0.321         0.518         0.122     < 0.001  \n\n - La Fianza         0.405       0.325         0.506         0.113     < 0.001  \n\n - Stellato          0.409       0.329         0.508         0.111     < 0.001  \n\n\n', 'Positive Likelihood Ratio Summary': 'Diagnostic Random-Effects Model\n\nMetric: Positive Likelihood Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             3.245       2.437         4.322         0.146     < 0.001  \n\n - Kinderman         3.012       2.315         3.920         0.134     < 0.001  \n\n - Lecart Lenfant    3.412       2.516         4.629         0.156     < 0.001  \n\n - Piver             3.044       2.325         3.985         0.137     < 0.001  \n\n - Piver Barlow      3.148       2.368         4.185         0.145     < 0.001  \n\n - Kolbenstvedt      3.474       2.506         4.816         0.167     < 0.001  \n\n - Lehman            3.151       2.346         4.233         0.151     < 0.001  \n\n - Brown             3.446       2.560         4.637         0.152     < 0.001  \n\n - Lagasse           3.387       2.482         4.621         0.159     < 0.001  \n\n - Kjorstad          3.401       2.501         4.626         0.157     < 0.001  \n\n - Ashraf            3.306       2.443         4.473         0.154     < 0.001  \n\n - De Muylder        3.290       2.427         4.460         0.155     < 0.001  \n\n - Smales            3.002       2.280         3.954         0.140     < 0.001  \n\n - Feigen            3.337       2.490         4.471         0.149     < 0.001  \n\n - Swart             3.378       2.498         4.569         0.154     < 0.001  \n\n - Heller            3.415       2.439         4.781         0.172     < 0.001  \n\n - La Fianza         3.013       2.288         3.967         0.140     < 0.001  \n\n - Stellato          3.195       2.376         4.295         0.151     < 0.001  \n\n\n', 'Odds Ratio Summary': 'Diagnostic Random-Effects Model\n\nMetric: Diagnostic Odds Ratio\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             9.648       5.529         16.835        0.284     < 0.001  \n\n - Kinderman         8.217       4.881         13.832        0.266     < 0.001  \n\n - Lecart Lenfant   10.039       5.593         18.020        0.298     < 0.001  \n\n - Piver             8.127       4.854         13.606        0.263     < 0.001  \n\n - Piver Barlow      9.130       5.204         16.018        0.287     < 0.001  \n\n - Kolbenstvedt     10.857       5.888         20.020        0.312     < 0.001  \n\n - Lehman            9.247       5.207         16.422        0.293     < 0.001  \n\n - Brown            10.027       5.633         17.847        0.294     < 0.001  \n\n - Lagasse          10.613       5.804         19.406        0.308     < 0.001  \n\n - Kjorstad         10.482       5.760         19.075        0.305     < 0.001  \n\n - Ashraf            9.974       5.565         17.874        0.298     < 0.001  \n\n - De Muylder       10.431       5.726         19.002        0.306     < 0.001  \n\n - Smales            8.773       5.012         15.356        0.286     < 0.001  \n\n - Feigen           10.585       6.005         18.658        0.289     < 0.001  \n\n - Swart            10.630       5.918         19.094        0.299     < 0.001  \n\n - Heller            9.927       5.330         18.488        0.317     < 0.001  \n\n - La Fianza         8.683       5.037         14.969        0.278     < 0.001  \n\n - Stellato          9.333       5.305         16.419        0.288     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {'NLR and PLR Forest Plot': 'r_tmp/1371822179.52674', 'Odds Ratio Forest Plot': 'r_tmp/1371822179.91372'}, 'image_order': None},
                             })
    
    method_and_params.append({
                              'meta_f_str': 'loo.ma.diagnostic',
                              'method': ['diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var', 'diagnostic.fixed.inv.var'],
                              'parameters': [{'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_nlr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'NLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_plr.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'PLR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}, {'conf.level': 95.0, 'digits': 3.0, 'fp_col2_str': u'[default]', 'fp_col3_str': u'[default]', 'rm.method': 'DL', 'fp_col4_str': u'Ev/Ctrl', 'fp_xticks': '[default]', 'fp_show_col4': False, 'fp_show_col3': True, 'fp_show_col2': True, 'fp_show_col1': True, 'fp_plot_lb': '[default]', 'fp_outpath': u'./r_tmp/forest_dor.png', 'to': 'only0', 'adjust': 0.5, 'fp_plot_ub': '[default]', 'fp_col1_str': u'Studies', 'measure': 'DOR', 'fp_xlabel': u'[default]', 'fp_show_summary_line': True}],
                              'results': {'images': {'NLR and PLR Forest Plot': './r_tmp/forest_nlr.png', 'Odds Ratio Forest Plot': './r_tmp/forest_dor.png'}, 'texts': {'Negative Likelihood Ratio Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             0.398       0.345         0.459         0.073     < 0.001  \n\n - Kinderman         0.398       0.345         0.460         0.074     < 0.001  \n\n - Lecart Lenfant    0.402       0.347         0.466         0.076     < 0.001  \n\n - Piver             0.399       0.345         0.461         0.074     < 0.001  \n\n - Piver Barlow      0.398       0.345         0.460         0.074     < 0.001  \n\n - Kolbenstvedt      0.356       0.302         0.420         0.084     < 0.001  \n\n - Lehman            0.405       0.350         0.469         0.075     < 0.001  \n\n - Brown             0.401       0.345         0.464         0.076     < 0.001  \n\n - Lagasse           0.387       0.333         0.449         0.076     < 0.001  \n\n - Kjorstad          0.392       0.338         0.455         0.076     < 0.001  \n\n - Ashraf            0.397       0.343         0.459         0.074     < 0.001  \n\n - De Muylder        0.390       0.337         0.452         0.075     < 0.001  \n\n - Smales            0.400       0.346         0.463         0.074     < 0.001  \n\n - Feigen            0.395       0.341         0.456         0.074     < 0.001  \n\n - Swart             0.390       0.337         0.452         0.075     < 0.001  \n\n - Heller            0.447       0.377         0.529         0.086     < 0.001  \n\n - La Fianza         0.406       0.351         0.469         0.074     < 0.001  \n\n - Stellato          0.408       0.353         0.472         0.074     < 0.001  \n\n\n', 'Positive Likelihood Ratio Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             2.726       2.361         3.147         0.073     < 0.001  \n\n - Kinderman         2.682       2.322         3.098         0.074     < 0.001  \n\n - Lecart Lenfant    2.783       2.400         3.228         0.076     < 0.001  \n\n - Piver             2.686       2.326         3.103         0.074     < 0.001  \n\n - Piver Barlow      2.702       2.339         3.121         0.074     < 0.001  \n\n - Kolbenstvedt      2.901       2.459         3.423         0.084     < 0.001  \n\n - Lehman            2.669       2.306         3.089         0.075     < 0.001  \n\n - Brown             2.822       2.433         3.272         0.076     < 0.001  \n\n - Lagasse           2.759       2.376         3.203         0.076     < 0.001  \n\n - Kjorstad          2.773       2.390         3.217         0.076     < 0.001  \n\n - Ashraf            2.725       2.355         3.153         0.074     < 0.001  \n\n - De Muylder        2.714       2.344         3.142         0.075     < 0.001  \n\n - Smales            2.649       2.291         3.063         0.074     < 0.001  \n\n - Feigen            2.744       2.375         3.170         0.074     < 0.001  \n\n - Swart             2.758       2.382         3.193         0.075     < 0.001  \n\n - Heller            2.659       2.246         3.149         0.086     < 0.001  \n\n - La Fianza         2.658       2.300         3.073         0.074     < 0.001  \n\n - Stellato          2.694       2.330         3.116         0.074     < 0.001  \n\n\n', 'Odds Ratio Summary': '\n\n Model Results\n\n Studies           Estimate   Lower bound   Upper bound   Std. error    p-Val   \n\n Overall             6.825       5.074         9.181         0.151     < 0.001  \n\n - Kinderman         6.412       4.752         8.651         0.153     < 0.001  \n\n - Lecart Lenfant    6.858       5.076         9.265         0.153     < 0.001  \n\n - Piver             6.387       4.734         8.619         0.153     < 0.001  \n\n - Piver Barlow      6.657       4.939         8.973         0.152     < 0.001  \n\n - Kolbenstvedt      8.564       6.011         12.201        0.181     < 0.001  \n\n - Lehman            6.606       4.890         8.924         0.153     < 0.001  \n\n - Brown             6.873       5.098         9.268         0.152     < 0.001  \n\n - Lagasse           7.196       5.267         9.832         0.159     < 0.001  \n\n - Kjorstad          7.064       5.193         9.610         0.157     < 0.001  \n\n - Ashraf            6.840       5.066         9.237         0.153     < 0.001  \n\n - De Muylder        7.026       5.165         9.557         0.157     < 0.001  \n\n - Smales            6.414       4.741         8.677         0.154     < 0.001  \n\n - Feigen            7.093       5.253         9.578         0.153     < 0.001  \n\n - Swart             7.157       5.276         9.709         0.156     < 0.001  \n\n - Heller            6.319       4.562         8.753         0.166     < 0.001  \n\n - La Fianza         6.546       4.855         8.825         0.152     < 0.001  \n\n - Stellato          6.722       4.990         9.054         0.152     < 0.001  \n\n\n'}, 'image_var_names': {'forest plot': 'forest.plot'}, 'image_params_paths': {'NLR and PLR Forest Plot': 'r_tmp/1371822186.41405', 'Odds Ratio Forest Plot': 'r_tmp/1371822186.71817'}, 'image_order': None},
                             })
    
    # for now just check that images and texts match
    for t in method_and_params:
        check_diagnostic_meta_method_analysis.description = "Testing Diagnostic Meta Method Analysis %s:%s" % (t['meta_f_str'], t['method'])
        yield check_continuous_meta_method_analysis, t


def check_diagnostic_multi_meta_analysis(test_data):
    test_result = meta_py_r.run_diagnostic_multi(test_data['method'], test_data['parameters'])
    _results_match(test_result, test_data['results'], ['images',]) #,'texts'])

# same as check_binary_meta_method_analysis--> should be refactored together
def check_diagnostic_meta_method_analysis(test_data):
    test_result = meta_py_r.run_meta_method_diag(test_data['meta_f_str'],
                                                 test_data['method'],
                                                 test_data['parameters'])
    _results_match(test_result, test_data['results'], ['images',]) #,'texts'])


        
####### Don't delete this. Its good to use as a template ####
#def setup_module(module):
#    print ("") # this is to get a newline after the dots
#    print ("setup_module before anything in this file")
#
#def teardown_module(module):
#    print ("teardown_module after everything in this file")
#
#def my_setup_function():
#    print ("my_setup_function")
#
#def my_teardown_function():
#    print ("my_teardown_function")
#
#@with_setup(my_setup_function, my_teardown_function)
#def test_numbers_3_4():
#    print 'test_numbers_3_4  <============================ actual test code'
#    assert multiply(3,4) == 12
#
#@with_setup(my_setup_function, my_teardown_function)
#def test_strings_a_3():
#    print 'test_strings_a_3  <============================ actual test code'
#    assert multiply('a',3) == 'aaa'
    



